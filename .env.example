# =============================================================================
# Escribano Configuration
# Copy this file to .env and adjust values as needed
# =============================================================================

# =============================================================================
# Frame Extraction
# =============================================================================
# Output frame width in pixels (height auto-calculated to preserve aspect ratio)
# Lower values = faster processing, less detail for VLM
# Examples: 1920 (full HD), 1280 (720p), 1024 (fast), 640 (very fast)
ESCRIBANO_FRAME_WIDTH=1024

# =============================================================================
# Scene Detection
# =============================================================================
# Sensitivity threshold for detecting scene changes (0.0 - 1.0)
# Lower = more sensitive = more scene changes detected = more frames
# Higher = less sensitive = fewer scene changes = fewer frames
# Examples: 0.3 (sensitive), 0.4 (default), 0.5 (conservative), 0.6 (very conservative)
ESCRIBANO_SCENE_THRESHOLD=0.4

# Minimum seconds between detected scene changes
# Prevents rapid-fire scene changes from generating too many frames
# Examples: 1 (aggressive), 2 (default), 3 (conservative), 5 (very conservative)
ESCRIBANO_SCENE_MIN_INTERVAL=2

# =============================================================================
# Frame Sampling (Adaptive)
# =============================================================================
# Base interval for frame sampling in seconds
# Frames are taken at this interval between scene changes
# Lower = more frames = longer processing = more detail
# Higher = fewer frames = faster processing = less detail
# Examples: 5 (dense), 10 (default), 20 (sparse), 30 (very sparse)
ESCRIBANO_SAMPLE_INTERVAL=10

# Gap threshold in seconds that triggers denser sampling
# If the gap between frames exceeds this, additional frames are inserted
# Examples: 10 (aggressive gap fill), 15 (default), 30 (conservative)
ESCRIBANO_SAMPLE_GAP_THRESHOLD=15

# Interval for filling detected gaps in seconds
# When a gap exceeds the threshold, frames are inserted at this interval
# Examples: 2 (dense), 3 (default), 5 (sparse)
ESCRIBANO_SAMPLE_GAP_FILL=3

# =============================================================================
# VLM (Visual Language Model)
# =============================================================================
# MLX model for frame analysis (local inference on Apple Silicon)
ESCRIBANO_VLM_MODEL=mlx-community/Qwen3-VL-2B-Instruct-4bit

# Frames per interleaved batch sent to VLM
# IMPORTANT: Lower values = more reliable parsing but slower processing
# - 4 frames: Fast (~1.7s/frame) but may truncate complex multi-screen frames
# - 2 frames: More reliable parsing for complex frames (~2s/frame)
# - 1 frame: Maximum reliability but slower (~3.5s/frame)
ESCRIBANO_VLM_BATCH_SIZE=2

# Token budget per batch for VLM responses
# IMPORTANT: This is the TOTAL budget for ALL frames in the batch
# - Batch size 4 + max tokens 2000 = 500 tokens/frame (may truncate complex frames)
# - Batch size 2 + max tokens 2000 = 1000 tokens/frame (better for complex frames)
# - Batch size 1 + max tokens 2000 = 2000 tokens/frame (maximum detail)
# If you see "Failed to parse" errors, try:
#   1. Reduce ESCRIBANO_VLM_BATCH_SIZE to 2
#   2. Increase ESCRIBANO_VLM_MAX_TOKENS to 4000
ESCRIBANO_VLM_MAX_TOKENS=2000

# =============================================================================
# MLX Bridge (Python subprocess for VLM inference)
# =============================================================================
# Unix socket path for MLX bridge communication
ESCRIBANO_MLX_SOCKET_PATH=/tmp/escribano-mlx.sock

# Timeout for MLX bridge model loading (milliseconds)
ESCRIBANO_MLX_STARTUP_TIMEOUT=60000

# Python executable path (auto-detected if not set)
# Priority: ESCRIBANO_PYTHON_PATH > VIRTUAL_ENV > ~/.venv/bin/python3 > system python3
# ESCRIBANO_PYTHON_PATH=/path/to/python

# =============================================================================
# LLM (Text Generation for Summaries)
# =============================================================================
# Ollama model for summary generation
# Uses Ollama, not MLX (for high-quality narrative generation)
ESCRIBANO_LLM_MODEL=qwen3:32b

# Model for subject grouping (optional, defaults to ESCRIBANO_LLM_MODEL if not set)
ESCRIBANO_SUBJECT_GROUPING_MODEL=qwen3:32b

# Enable thinking mode for artifact/card generation (slower but potentially higher quality)
# Defaults to false for fast card generation
ESCRIBANO_ARTIFACT_THINK=false

# Number of parallel inference slots for Ollama
# Note: This configures the Ollama server, not Escribano itself
OLLAMA_NUM_PARALLEL=1

# =============================================================================
# Transcription
# =============================================================================
ESCRIBANO_PARALLEL_TRANSCRIPTION=false

# =============================================================================
# Debugging
# =============================================================================
# Enable verbose pipeline logging
ESCRIBANO_VERBOSE=false

# Debug Ollama request/response logging (includes full prompt preview)
ESCRIBANO_DEBUG_OLLAMA=false

# Debug VLM processing logging
ESCRIBANO_DEBUG_VLM=false

# Skip LLM summary generation (use template fallback)
ESCRIBANO_SKIP_LLM=false

# =============================================================================
# Outline Publishing (Optional)
# =============================================================================
ESCRIBANO_OUTLINE_URL=
ESCRIBANO_OUTLINE_TOKEN=
ESCRIBANO_OUTLINE_COLLECTION=Escribano Sessions

# =============================================================================
# DEPRECATED (V2, not used in V3 pipeline)
# =============================================================================
# ESCRIBANO_FRAME_INTERVAL=2
# ESCRIBANO_EMBED_MODEL=qwen3-embedding:8b
# ESCRIBANO_EMBED_BATCH_SIZE=64
# ESCRIBANO_EMBED_CONCURRENCY=4
# ESCRIBANO_CLUSTER_TIME_WINDOW=600
# ESCRIBANO_CLUSTER_DISTANCE_THRESHOLD=0.4
# OLLAMA_CONTEXT_LENGTH=40000
